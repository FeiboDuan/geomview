\documentclass[12pt,a4paper]{book}
\usepackage[utf8]{inputenc}
\usepackage[brazil]{babel}
\usepackage{hyperref}
\usepackage{graphicx}
\begin{document}
%% baseado no md5sum 35ea8b85959738edb8f44efb63802f06  oogltour

\vspace*{6cm}
\huge
\begin{center}
Tutorial\\
Os Formatos de Arquivo da OOGL\\
(e Geomview ao longo do caminho)
\end{center}
\normalsize
\vspace*{5cm}
\newpage
\chapter{Introduction}

OOGL significa Object Oriented Graphics Library.  Um objeto OOGL é
chamado um Geom. Existe um formato de arquivo texto para cada tipo de Geom. Você
pode chamar um arquivo texto dentro de qualquer programa que usa a OOGL. Geomview é um
visualizadodr interativo de objetos em 3D construído no topo da OOGL. (Geomview executa nas
plantaformas Silicon Graphics, NextStep, e X-Windows.) Existe
notas do GEOMVIEW em seções específicas distribuídas por esse guia dizendo
a você o que fazer no Geomview para ver sobre o que estamos falando. As seções do GEOMVIEW
subsequêntes assumem que você sabe como fazer e concluiu o que as notas do GEOMVIEW anteriores
disseram sobre Geomview e os formatos de arquivo da OOGL. Todos os arquivos mencionados nesse documento estão no
diretório de arquivos exemplos da OOGL que acompanha o Geomview.

A seção Formatos de Arquivo da OOGL do manual do Geomview é uma referência
completa para a sintaxe de formatos de arquivo. Esse tutorial é uma tentativa
de conduzir você mais gentilmente no mundo da OOGL.

\chapter{QUAD}

Iniciamos com um objeto muito simples: um quadrado. Especificamente, o quadrado
unitário no plano xy e com z=0. O nome do arquivo no diretório do Geomview é ``square.quad'':

\begin{verbatim}
QUAD
-1 -1 0 #vertice 0
1 -1 0  #vertice 1
1 1 0   #vertice 2
-1 1 0  #vertice 3
\end{verbatim}

O cabeçalho ``QUAD'' identifica o tipo de arquivo.  (Você pode também usar o
cabeçalho ``POLY'' para esse tipo por razões históricas.)  Um arquivo QUAD é uma
lista de 4*n vertices onde n é o número de quadriláteros. Esse
arquivo somente contém um quadrilátero.  Você pode também usar esse formato para
especificar triângulos: apenas use um quadrilátero degenerado onde dois dos
quatro vértices são identicos.  Os vértices nesse arquivo são
simples: apenas as coordenadas x,y, e z do ponto.

\section{GEOMVIEW}

Digite ``geomview square.quad'' a partir de uma janela de shell.
Gire o quadrado com o botão esquerdo do mouse
após o geomview carregar o quadrado. Sinta-se livre para brincar com o geomview por um momento se
a imaginação atingir você durante esse tutorial.
\footnote{Nota do tradutor: veja a seção \ref{adc00} para mais informação.}

\section{Colorindo}

O arquivo seguinte tem vértices mais complexos que incluem uma cor no ponto. 
O nome do arquivo no diretório do Geomview é ``csquare.quad'':

\begin{verbatim}
CQUAD
-1 -1 0		1 0 0 1
1 -1 0		0 1 0 1
1 1 0		0 1 0 1
-1 1 0		1 0 0 1
\end{verbatim}

O csquare.quad pegou os mesmos pontos do quadrado anterior, mas com dois cantos vermelhos e
dois cantos verdes. O cabeçalho é agora ``CQUAD'' para indicar que seus
vértices possuem informação de cor além das informações do ponto.
Cores são especificadas por quádruplas (r,g,b,a) de números em ponto flutuante
entre 0 e 1. Qualquer cor que que puder ser mostrada na tela de um computador
pode ser codificada por alguma combinação de vermelho (\textit{red}), verde (\textit{green}) e azul (\textit{blue}). O quarto
componente, alfa, representa opacidade: 0 é transparente e 1 é
opaco. As plantaformas X, NextStep, e algumas plantaformas SGI ignoram a informação
alfa inteiramente, mas um instantâneo Renderman irá usar a informação
alfa se a transparência estiver habilitada. Algumas plantaformas SGI usan a
informação alfa, mas a figura é garantidamente incorreta.

\section{GEOMVIEW}

Apague o objeto atual pressionando o Botão Delete.  Para
chamar csquare.quad, pressione o Botão Load e digite ``csquare.quad'' (pressione
Enter quando você tiver terminado a digitação) dentro da janela que aparece. (Se
você está procurando e não tem certeza no nome dos arquivos, você pode usar o
Botão File Browser (navegador de arquivos) para olhar em um diretório.)

Você está provavelmente maravilhado porque está tudo em uma cor.  O modo de sombreamento
padrão é monótono, onde cada polígono ou face poligonal é da mesma
cor. Os outros dois modos de sombreamento, constante e suave, irão ambos
mostrar faces multicoloridas onde as cores suavemente interpolada
entre os vértices. Sombreamento Constant ignora todas as informações de iluminação,
enquanto sombreamento smooth (suave) interpola iluminação bem como cores entre
os vértices.

Para mudar o modo de sombreamento, primeiro abra o painel Appearance clicando
na linha Appearance no menu Inspect.  Agora alterne de
modo para modo clicando sobre diferentes linhas no navegador de sombreamento.
\footnote{Nota do tradutor: CSmooth - suave com mais brilho, VCflat - monótono com menos brilho}

Hora de ir para coisas maiores e melhores. 

\section{DODEC.QUAD}

\begin{verbatim}
"dodec.quad":

QUAD
0.467086 0.151765 0.794654 0.356822 0.491123 0.794654 0 0.491123 0.794654 0 0 0.794654
4.89153e-09 0.491123 0.794654 -0.356822 0.491123 0.794654 -0.467086 0.151765 0.794654 0 0 0.794654
-0.467086 0.151766 0.794654 -0.57735 -0.187593 0.794654 -0.288675 -0.397327 0.794654 0 0 0.794654
-0.288675 -0.397327 0.794654 4.36694e-09 -0.607062 0.794654 0.288675 -0.397327 0.794654 0 0 0.794654
0.288675 -0.397327 0.794654 0.57735 -0.187592 0.794654 0.467086 0.151766 0.794654 0 0 0.794654
-0.467086 0.642889 0.491123 -0.356822 0.491123 0.794654 0 0.491123 0.794654 0 0.710761 0.35538
	.
	.
	.
 < 53 lines of numbers deleted>
\end{verbatim}

Agora encontramos um objeto mais interessante: umdodecaedro.  Uma vez que
dodecaedros possuem faces de 5 lados, cada uma dessas 12 faces é atualmente feita
de 5 quadriláteros formando ao todo 20 quadriláteros nesse objeto Quad.

\section{GEOMVIEW}

Apague o quadrado e chame ``dodec.quad''. Uma vez que os 5
quadriláteros de cada face todos se ajustam juntos perfeitamente, o fato de
existirem certamente muitos deles em cada face é somente notado quando as
arestas são desenhadas. Para habilitar o desenho das arestas, pressione o botão Edges no
painel Appearance.

\chapter{OFF}

Existe um caminho muito mais eficiente de represetnar um dodecaedro.

\begin{verbatim}
"dodec.off":

OFF
20 12 30
	1.214124 0.000000 1.589309
	0.375185 1.154701 1.589309
	-0.982247 0.713644 1.589309
	-0.982247 -0.713644 1.589309
	0.375185 -1.154701 1.589309
	1.964494 0.000000 0.375185
	0.607062 1.868345 0.375185
	-1.589309 1.154701 0.375185
	-1.589309 -1.154701 0.375185
	0.607062 -1.868345 0.375185
	1.589309 1.154701 -0.375185
	-0.607062 1.868345 -0.375185
	-1.964494 0.000000 -0.375185
	-0.607062 -1.868345 -0.375185
	1.589309 -1.154701 -0.375185
	0.982247 0.713644 -1.589309
	-0.375185 1.154701 -1.589309
	-1.214124 0.000000 -1.589309
	-0.375185 -1.154701 -1.589309
	0.982247 -0.713644 -1.589309
	5 0 1 2 3 4
	5 0 5 10 6 1
	5 1 6 11 7 2
	5 2 7 12 8 3
	5 3 8 13 9 4
	5 4 9 14 5 0
	5 15 10 5 14 19
	5 16 11 6 10 15
	5 17 12 7 11 16
	5 18 13 8 12 17
	5 19 14 9 13 18
	5 19 18 17 16 15
\end{verbatim}

O cabeçalho ``OFF'' nos diz que é um arquivo polilista (lista de polígonos). A segunda linha no
arquivo nos diz que existem 20 vértices, 12 faces, and 30 arestas.
(As biliotecas OOGL atualmente não usa ao valores de aresta, de forma que você pode
usar 0 se você não souber o número de arestas.)  As seguintes 20
linhas fornecem uma lista dos vértices. As últimas 12 linha especificam as faces:
o primeiro número é o número de vértices naquela face. Uma vez que nosso
poliedro é regular, todas as faces posuem o mesmo número de
vértices (nesse caso, 5).  Os restantes números na linha são
índices dentro da lista de vértices acima.

Além de ser de longe mais compacto, o formato de arquivo Polilista incorpora
informação de conectividade no Geom.  OOGL não tem como saber
se quaisquer dois quadriláteros em um objeto Quad estão conectadas.  Mas
com Polilista, OOGL pode interpolar normais através de faces conectadas.
Os normais de um objeto são usadas para calcular informação de sombreamento.
Normais interpoladas fazem um objeto parecer-ser suave ao invés de facetado.
Esse comportamento é muitas vezes desejável se você está tentando aproximar uma superfície
curvada quebando-a em pequenas peças.

\section{GEOMVIEW}

Vá adiante e chame ``dodec.off'' sem apagar o dodec.quad .  Agora
você tem dois Geoms no seu mundo.  A maioria das ações aplicam-se ao
objeto atualmente selecionado. Quando você inicia o geomview, o objeto
atualmente selecionado é o mundo todo. Você pode independentemente controlar qualquer
objeto no mundo selecionado-o como o alvo de suas ações.
Um duplo clique com o botão direito do mouse quando o mouse estiver sobre um
objeto seleciona-o: dar um duplo clique com o botão direito do mouse sobre o espaço vazio
seleciona o mundo todo. Você pode também selecionar objetos clicando sobre a
linha apropriada no navegador Object.

Os dois dodecaedros estão provavelmente sobrepostos.  Selecione um deles como
seu alvo, clique na linha ``Translate'' (transladar) no navegador de movimentos, e
mova a objeto selecionado paa adiante do centro do mundo com o botão esquerdo
do mouse.  (Para retornar para o modo ``Rotate'' (rotação), clique na linha apropriada no
navegador de movimento.)
 
Agora selecione o mundo todo novamente e desenhe as normais pressionando o
botão ``Normals'' (normais) no painel Appearance. Mude entre os modos de sombreamento
Flat e Smooth (clicando no navegador Shading) e verifique
que a Polilista muda mas o Quad não.  

Algumas vezes usando o mouse para clicar nas linhas e botões do navegador é
incômodo. Os caracteres entre os colchêtes mostrados nos painéis de controle são
atalhos de teclado que copiam o efeito de usar o mouse para
clicar naquela linha ou botão. Por exemplo, ``an'' (the ``a'' significa
``appearance'') alterna o desenho das normais e ``t'' aterna o movimento para
translatção.  Adicionalmente a teclas de atalho, você pode usar o prefixo de umn
objeto (``g'' or ``c'' seguido por um número, como mostrado nos colchêtes no
navegador Object) antes da maioria dos comandos para simultâneamente selecionar um objeto
e fazer alguma ação sobre esse objeto selecionado. Por exemplo, ``g0r'' conduz você imediatamente
a rotacionar o mundo.

\section{Colorindo Polilista}

Vamos comparar duas formas de colorir Polilista.

\begin{verbatim}
facecube.off:

# off file with per face color
OFF
8 6 12
     1.0 1.0 1.0 
     1.0 1.0 -1.0 
     1.0 -1.0 1.0 
     1.0 -1.0 -1.0 
     -1.0 1.0 1.0 
     -1.0 1.0 -1.0 
     -1.0 -1.0 1.0 
     -1.0 -1.0 -1.0 
     4 0 2 3 1  .05 .8 .1 .75
     4 4 5 7 6  .2 .05 .8 .75
     4 0 4 6 2  .9 .9 .02 .75
     4 1 3 7 5  .0 .7 .4 .75
     4 0 1 5 4  .1 .4 .7 .75
     4 2 6 7 3  .7 .7 0 .75

vertcube.off:

# off file with per vertex colors
COFF
8 6 12
     1.0 1.0 1.0 	.05 .8 .1 .75
     1.0 1.0 -1.0	.2 .05 .8 .75 
     1.0 -1.0 1.0	.9 .9 .02 .75 
     1.0 -1.0 -1.0 	.0 .7 .4 .75
     -1.0 1.0 1.0 	.1 .4 .7 .75
     -1.0 1.0 -1.0 	.7 .7 0 .75
     -1.0 -1.0 1.0 	0. 0. 0. .75
     -1.0 -1.0 -1.0 	1. 1. 1. .75	
     4 0 2 3 1  
     4 4 5 7 6  
     4 0 4 6 2  
     4 1 3 7 5  
     4 0 1 5 4  
     4 2 6 7 3  
\end{verbatim}

Tudo seguindo uma ``#'' (cerquilha) é um comentário para humanos lerem e é
ignorado pela OOGL. o cabeçalho para arquivo de Polilista puro é opcional, mas
se você tem qualquer coisa além de pontos em um vértice você torna necessário um apropriado
cabeçalho.  O obeto é o cubo unitário, que tem 8 vértices, 6 faces,
e 12 arestas.  O primeiro tem coloração por face d o segundo tem
coloração por vértice.

Um ponto inusitado: o cabeçalho para vertcube.off é ``COFF'' como você poderia
esperar mas o cabeçalho para facecube.off é apenas ``OFF'' pelo fato de o
cabeçalho referir-se somente à estrutura dos vértices, não ao arquivo
como um todo.

\section{GEOMVIEW}
Apague tudo selecionado o mundo e pressionado o botão Delete
Object. Agora chame ``facecube.off'' e ``vertcube.off''. Translade um
deles para além do centro de forma que você possa ver o que você está fazendo.
Alterne ambas as Polilistas entre os modos de sombreamento Constant, Flat, e
Smooth.

Sombreamento é feito conforme as fontes de luz que você controla.
Para brincar com luzes, abra o painel Light clicando sobre a linha
Light no menu Inspect pull-down. Quando você pressiona o botão Show Lights,
você irá ver fontes de luzes que você pode arrastar por aí para mover as luzes.
Você pode também adicionar, apagar, mudar a intensidade, e mudar a
cor da luzes.

\chapter{MESH}

Os vértices de um arquivo Mesh são conectados em uma grade retangular.

\begin{verbatim}
tent.mesh:
CMESH
3 3
0 0 0  1 0 0 1	   1 0 1  0 1 0 1	    2 0 0  0 0 1 1
0 1 0  1 0 0 1	   1 1 1  0 1 0 1	    2 1 0  0 0 1 1
0 2 0  1 0 0 1	   1 2 1  0 1 0 1	    2 2 0  0 0 1 1
\end{verbatim}

O cabeçalho ``CMESH'' nos diz que é um arquivo Mesh e que cada vértice
contém ambas as informações de ponto e cor.  A segunda linha significa que
ambas as dimensões u e v da malha é 3, de forma que existirá 3*3 =
9 vértices. Cada vértice que não for uma aresta externa está conectado a
seus 4 vizinhos mais próximos por uma aresta. Em ``tent.mesh'', somente o
ponto (1,1,1) é um ponto interno. Os 9 vértices, quando nomeados (u,v),
são especificados na ordem crescente do valor de v, da mesma forma que vetores estáticos em C:

\begin{verbatim}
(0,0)---(1,0)---(2,0)   
  |	  |	  |
(0,1)---(1,1)---(2,1)
  |	  |	  |
(0,2}---(1,2)---(2,2)
\end{verbatim}

\section{GEOMVIEW}

Apague tudo e chame ``tent.mesh''. Vé para o modo de sombreamento Smooth para
ver cada vértice com sua prórpira cor de forma que seja óbvio como os pontos no
arquivo correspondem-se coma imagem no visualizador.

\section{Grade Fechada}

Se você deseja que a grade seja fechada ao longo ou de um ou de outro (ou de ambas) as areatas
u ou v, insira ou um ``u'' ou um ``v'' no cabeçalho antes de
``MESH''.
\begin{verbatim}
"wraptent.mesh" 
CuMESH
3 3
0 0 0  1 0 0 1	   1 0 1  0 1 0 1	    2 0 0  0 0 1 1
0 1 0  1 0 0 1	   1 1 1  0 1 0 1	    2 1 0  0 0 1 1
0 2 0  1 0 0 1	   1 2 1  0 1 0 1	    2 2 0  0 0 1 1
\end{verbatim}

\section{GEOMVIEW}

Chame ``wraptent.mesh'' e compare as duas malhas, transladando-as
separadamente da outra quando necessário.

\section{Eficiência}

Existe um caminho extremamente eficiente para descrever uma malha quando as coordenadas
x e o y coincidem com as coordenadas de u e de v de todos os pontos.

\begin{verbatim}
"ztent.mesh":
ZMESH
3 3
0 1 0
0 1 0
0 1 0
\end{verbatim}

O arquivo ``ztent.mesh'' tem exatamente a mesma aparência que ``tent.mesh'', embora seus
vértices não tenham cores. O cabeçalho ``ZMESH'' significa que somente
acoordenada z-coordinate de cada ponto é especificada e as coordenadas
x e y de cada ponto são ajustadas para serem iguais às coordenadas de sua posição (u,v) na
grade.

\section{GEOMVIEW}

Chame ``ztent.mesh'' para verificar que ela tem realmente a mesma aparência que ``tent.mesh''.

\chapter{VECT}

Um Vect é uma coleção de polilinhas, que são linhas com 1 ou mais
vértices. Aqui está um arquivo especificando um ``X'' e o eixo x em vermelho, um ``Y''
e o eixo y em verde, e um ``Z'' e o eixo z em azul.

\begin{verbatim}
"xyz.vect":
VECT
8 19 3
2 2 2 2 2 3 2 4 
1 0 0 1 0 0 1 0

0 0 0  1 0 0
1 -.05 .05   1  .05 .25
1  .05 .05   1 -.05 .25

0 0 0  0 1 0
-.05 1 .25   0  1   .15
 .05 1 .25   0  1   .15   0  1  .05

0 0 0  0 0 1
-.05 .25 1  .05 .25 1   -.05 .05 1   .05  .05  1

1 0 0 1
0 1 0 1
0 .6 1 1
\end{verbatim}

O cabeçalho é sempre ``VECT'': nenhuma letra pode ser pregada na frente.
A segunda linha significa que existem 8 polilinhas, que possuem um total
de 19 vértices e 3 cores. Não existe indexação em uma lista de
vértices como existe na polilista: todo vértice simples deve ser especificado
separadamente. A terceira linha lista o número de vértices em cada
polilinha. Em ``xyz.vect'', as únicas polilinhas com mais que 2 vértices
são a parte alta do ``Y'', que tem 3, e o ``Z'', que tem 4.
A quarta linha lista o número de cores em cada polilinha.  Quando uma
polilinha não tem cores ela herda o conjunto de cores ajustado anteriormente.  A seguir
vem os 19 vértices: somente pontos são permitidos. Finalmente, as 3 cores
são dadas nas últimas três linhas.

\section{GEOMVIEW} 

Apague tudo, chame e olhe para ``xyz.vect''. Faça a mesma coisa para
todos os exemplos restantes.

\chapter{BEZ}

Para aqueles que já entendem como criarretalhos de superfícies
paramétricas, a sintaxe de retalhos de superfícies de Bezier é descrito na página de manual
da OOGL.  A arte de constuir superfícies paramétricas não é facilmente
explicada: dessa forma, está além do escopo desse tutorial discutí-las.

Lists e Insts são complexos Geoms que podem ser usados para criar uma
árvore hierárquica de objetos. 

\chapter{LIST}

Uma List é apenas uma coleção de outros Geoms.

\begin{verbatim}
"ref.list":
LIST
< xyz.vect
< dodec.quad
{ = QUAD -1 -1 0   1 -1 0  1 1 0  -1 1 0}
\end{verbatim}

O cabeçalho é sempre e exatamente ``LIST''. Os primeiros dois subgeoms referem-se a
outroa arquivos, usando a sintaxe `` < nomearquivo ''. Omitimos as
opcionais chaves marcando o início e o fim do arquivo.  O erceiro é um objeto literal,
ou in-line. Embora essa sintaxe em particular possa ainda funcionar se abandonarmos
as chaves delimitando e o sinal de igual, sintaxe muito similar pode
não funcionar então seguimos a regra ``na dúvida, use as chaves''.

\section{GEOMVIEW}
Geomview procura por nomes de arquivos no diretório atual, no come do caminho na
variável de ambiente GEOMDATA, e o mesmo diretório que o arquivo
que está atualmente sendo aberto. 

\chapter{INST}

Um Inst é uma ou mais transformações 4x4 aplicada(s) a outro Geom.  Essas
matrizes podem representar todas as transformações 3D tais como rotação,
translação, homotetia, redução e perspectiva.  Usamos matrizes 4x4
ao invés de matrizes 3x3 de forma que possamos usr coordenadas homogêneas e
concatenar todas as transformações sem tratar translações como
casos especiais que requerem adiçòes ao invés de multiplicações.  Matrizes
4x4 podem também serem usadas para cada operações tais como rotação 4D ou
transformações hiperbólicas projetivas. Um livro texto de álgebra linear ou um livro texto de
computação gráfica são bons lugares para iniciar se você tem pouca familiaridade com
essas idéias.
\begin{verbatim}
"ref.inst":
INST
geom { < ref.list }
transforms { = 
TLIST
 1 0 0 0
 0 1 0 0
 0 0 1 0
 2 0 0 1

 1 0 0 0
 0 1 0 0
 0 0 1 0
 0 2 0 1

 1 0 0 0
 0 1 0 0
 0 0 1 0
 0 0 2 1

 1 0 0 0
 0 1 0 0
 0 0 1 0
 0 0 0 1
}
\end{verbatim}

O cabeçalho é sempre e exatamente ``INST''. O valor seguindo a palavra chave
``geom'' é um nome de arquivo referindo-se a ``ref.list'', que é o List que
mostramos acima.  Pode também ser um Geom in-line ou um controlador. Cercamos
o valor com chaves para evitar ambiguidade.

O valor da palavra chave ``transforms'' é uma TList in-line. Pode
também ser uma referência a nomearquivo ou um controlador. (Veja a seção Os formatos de
Arquivo da OOGL do manual do Geomview para informações mais específicas.) TList é atualmente um
Geom completamente fugidio, mas nem mesmo chamamos um arquivo como ``algumacoisa.tlist'' no
visualizador pelo fato de TLists serem apenas uma coleção de transformações sem nenhum
subgeom associado, de forma que não existe nada para ver.

Uma transformação é exatamente 16. Os primeiros três conjuntos de 16 números são translações:
2 unidades na direção x, y e z, respectivamente. O último conjunto de 16 números é apenas
a identidade. O comprimento da TList é o número de instanciações da unidade: nesse caso, 4.

Se não quisermos usar instanciação, teremos que calcular 4
Geoms inteiramente novos, uma vez que os pontos atuais no espaço de um objeto são
diferentes se você movê-lo. Uma vez que a unidade de um Inst pode ser outro
Inst, você pode construir uma complexa hierarquia. Por exemplo, para construir um
sistema solar você somente precisa gerar uma esfera. Todos os planetas podem ser
conseguidos ajustando proporcionalmente e transladandos instanciações daque Geom simples inicial.

\begin{verbatim}
"warp.inst":
INST
transform {
		1 0 0 0
		0 9 0 0
		0 0 3 0
		0 0 0 1
}
geom { < dodec.off }
\end{verbatim}

